# Project Setup Guide

This guide will help you clone and configure this monorepo for your own project. The monorepo has been designed to be easily reusable with minimal configuration changes.

## Quick Start

1. **Clone the repository**
   ```bash
   git clone <your-repo-url>
   cd exam-questions
   ```

2. **Run the setup script**
   ```bash
   ./setup-project.sh
   ```

   The script will prompt you for:
   - App Name (e.g., "myapp")
   - App Display Name (e.g., "My App")
   - GCP Project ID
   - Firebase Project ID
   - GCP Region

3. **Configure Secrets**

   All secrets are now in the root `.env` file:
   - JWT_SECRET and REFRESH_SECRET (generate new ones!)
   - GEMINI_API_KEY (or other AI provider keys)
   - Database credentials
   - Auth provider credentials

   All apps (api, web, future apps/ai, etc.) load from the same root `.env`.

4. **Install dependencies**
   ```bash
   npm install
   ```

5. **Start development**
   ```bash
   npm run dev
   ```

## What Gets Configured

The setup script automatically updates:

### Root Configuration (`.env`)
- Project identity (APP_NAME, APP_DISPLAY_NAME)
- GCP and Firebase project IDs
- Service URLs and endpoints
- CORS origins
- Cloud Run configuration

### Firebase Configuration
- `.firebaserc` (root and apps/web)
- Both files are updated with your Firebase project ID

### PWA Manifest
- `apps/web/public/favicon/site.webmanifest`
- Updated with your app display name

### GitHub CI/CD
- `.github/project-config.yml`
- Updated with all project-specific values

## Manual Configuration

Some files need manual updates if you want to change them:

### Package Names
- `apps/web/package.json` - Update the "name" field if desired
- `package.json` (root) - Update if you want to rename the monorepo

### Documentation
- Update all markdown files in `docs/` with your project specifics
- Update this SETUP.md for your team

## Environment Variables Reference

### Root `.env` (Project-Level)
Generated by `setup-project.sh`:

```bash
# Project Identity
PROJECT_ID=your-project-id
APP_NAME=myapp
APP_DISPLAY_NAME=My App

# Firebase Configuration
FIREBASE_PROJECT_ID=your-firebase-project

# GCP Configuration
GCP_PROJECT_ID=your-gcp-project
GCP_LOCATION=us-central1
GCP_SERVICE_ACCOUNT=github-actions-cloudrun@your-gcp-project.iam.gserviceaccount.com
GCP_ARTIFACT_REPOSITORY=myapp-api-images

# URLs - Production
API_URL_MAIN=https://myapp-api-xxx.a.run.app
WEB_URL_MAIN=https://your-firebase-project.web.app

# URLs - Branch Pattern
API_URL_BRANCH_PATTERN=https://api-{branch}.your-project.a.run.app
WEB_URL_BRANCH_PATTERN=https://your-firebase-project--branch-{pr_number}-{hash}.web.app

# Cloud Run Configuration
CLOUD_RUN_SERVICE_NAME_PATTERN=myapp-api-{branch}
CLOUD_RUN_REGION=us-central1

# CORS Origins
CORS_ORIGINS=https://your-firebase-project.web.app,https://your-firebase-project--*

# Vite Environment Variables
VITE_APP_NAME=myapp
VITE_APP_DISPLAY_NAME=My App
```

All secrets are now consolidated in the root `.env` file for shared access across all apps (api, web, future apps/ai, etc.).

## GitHub Actions Setup

For CI/CD to work, configure these secrets in your GitHub repository:

1. Go to: **Settings ‚Üí Secrets and variables ‚Üí Actions**

2. Add the following secrets:

   | Secret Name | Description | Where to Get It |
   |-------------|-------------|-----------------|
   | `GCP_SA_KEY` | GCP service account JSON | GCP Console ‚Üí IAM ‚Üí Service Accounts |
   | `GCP_PROJECT_ID` | Your GCP project ID | Same as in .env |
   | `FIREBASE_SERVICE_ACCOUNT_KEY` | Firebase service account JSON | Firebase Console ‚Üí Project Settings |
   | `FIREBASE_PROJECT_ID` | Your Firebase project ID | Same as in .env |
   | `APP_NAME` | Your app name | Same as in .env |
   | `APP_DISPLAY_NAME` | Your app display name | Same as in .env |

3. Optional secrets (if you override defaults):
   - `API_URL_MAIN`
   - `WEB_URL_MAIN`
   - Any other custom environment variables

## Files That Reference Project Names

After running the setup script, these files will be configured:

### Automatically Updated
- ‚úÖ `.env` - Root configuration
- ‚úÖ `.firebaserc` - Firebase projects
- ‚úÖ `apps/web/.firebaserc` - Web Firebase project
- ‚úÖ `apps/web/public/favicon/site.webmanifest` - PWA manifest
- ‚úÖ `.github/project-config.yml` - CI/CD config

### Use Environment Variables (No Manual Changes Needed)
- ‚úÖ `apps/api/server.ts` - CORS, startup messages
- ‚úÖ `apps/api/routes/setup/health/hello.ts` - API greeting
- ‚úÖ `apps/api/services/webhookService.ts` - User-Agent header
- ‚úÖ `apps/api/test-utilities/urls.ts` - Test URLs
- ‚úÖ `apps/api/test-prod-api.ts` - Production test URLs
- ‚úÖ `apps/api/test-vertex-ai.ts` - GCP project ID
- ‚úÖ `apps/api/playwright.prod.config.ts` - Playwright base URL
- ‚úÖ `gcp-setup/deploy-api.sh` - Deployment script
- ‚úÖ `gcp-setup/deploy-web.sh` - Deployment script
- ‚úÖ `gcp-setup/setup.sh` - GCP setup script
- ‚úÖ `e2e/playwright.*.ts` - E2E test configs
- ‚úÖ `apps/web/index.html` - Page title (uses Vite %VITE_APP_DISPLAY_NAME%)

### Optional Manual Updates (For Complete Rebrand)
- üìù `apps/web/package.json` - Package name
- üìù All documentation files in `docs/`
- üìù README.md files
- üìù Test files that check for specific text (e.g., "Hello World from Dottie API!")

## Testing Your Setup

After configuration:

1. **Test environment loading**
   ```bash
   npm run dev
   # Should show: "üöÄ Starting [Your App Name] server..."
   ```

2. **Test API endpoint**
   ```bash
   curl http://localhost:5000/api/setup/health/hello
   # Should return: {"message":"Hello World from [Your App Name] API!"}
   ```

3. **Test web app**
   - Open http://localhost:5173
   - Check page title in browser tab (should show your app name)
   - Check PWA manifest (View Page Source ‚Üí find manifest link)

4. **Test deployment scripts**
   ```bash
   # Set environment variables
   export APP_NAME=myapp
   export FIREBASE_PROJECT_ID=myapp-firebase

   # Dry run (check commands without executing)
   ./gcp-setup/deploy-api.sh --help
   ```

## Troubleshooting

### Issue: Environment variables not loading

**Solution**: Make sure you have a root `.env` file with all project config and secrets. All apps load from the root `.env` file now.

### Issue: Firebase deployment fails

**Solution**:
1. Check `.firebaserc` has the correct project ID
2. Run `firebase login` to authenticate
3. Run `firebase use` to verify the active project

### Issue: CORS errors in production

**Solution**:
1. Check `CORS_ORIGINS` in root `.env`
2. Verify it includes your production URL
3. For GitHub Actions, make sure `FIREBASE_PROJECT_ID` secret is set

### Issue: Tests failing with "dottie" references

**Solution**: Some test files may check for specific text strings. Update test expectations to match your new app name.

## Advanced: Custom Deployment

If you need custom deployment configurations:

1. **Custom Cloud Run regions**
   - Update `GCP_LOCATION` in `.env`
   - Update `.github/project-config.yml` ‚Üí `cloud_run.region`

2. **Custom domain names**
   - Update `API_URL_MAIN` and `WEB_URL_MAIN` in `.env`
   - Configure custom domains in GCP and Firebase consoles

3. **Multiple environments**
   - Create `.env.staging`, `.env.production`
   - Use `dotenv-cli` to load specific env files
   - Update CI/CD workflows to use different secrets per environment

## Need Help?

- Review `.env.example` for all available configuration options
- Check `.github/project-config.yml` for CI/CD configuration reference
- See `gcp-setup/README.md` for GCP-specific setup
- See `docs/workflows.md` for CI/CD workflow documentation

## Summary Checklist

- [ ] Run `./setup-project.sh`
- [ ] Configure `apps/api/.env` with secrets
- [ ] Set up GitHub secrets
- [ ] Update package.json names (optional)
- [ ] Update documentation (optional)
- [ ] Test local development
- [ ] Test deployments
- [ ] Update branding/assets (icons, favicons)
- [ ] Remove this SETUP.md or customize it for your team
